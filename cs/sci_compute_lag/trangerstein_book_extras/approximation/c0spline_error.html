<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE>continuous spline approximation to runge function</TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
  </HEAD>
  <BODY>
    <h2>
    continuous spline approximation to runge function
    </h2>
    <br>
    \(\log_{10}( \text{max error} ) \text{vs} \log_{10}( \text{number elements} ) \)
    <br>
    <script src=interpolate.js></script>
    <script src=../plotting/XYGraphTool.js></script>
    <script language="javascript">
      var farray = new Array();
      var nodes = new Array(); // mesh nodes
      var xipts = new Array(); // canonical interpolation points
      var n = 1;
      var m = 1;
      var w = 1;
      var equally_spaced_interpolation_points = true;

      function f( x ) { return 1 / ( 1 + 25 * x * x ); }
      function computeNodes( ) {
        nodes = new Array( n + 1 );
        var dx = 2 / n;
        nodes[ 0 ] = -1;
        for ( var i = 1; i < n; i ++ ) nodes[ i ] = i * dx - 1;
        nodes[ n ] = 1;
      }
      function computeInterpolationPoints( ) {
        xipts = new Array( m + 1 );
        xipts[ 0 ] = 0;
        if ( equally_spaced_interpolation_points ) {
          var dxi = 1 / m;
          for ( var j = 1; j < m; j ++ ) xipts[ j ] = j * dxi;
        } else {
          for ( var j = 1; j < m; j ++ ) xipts[ j ] =
            Math.pow( Math.sin( ( 2 * j - 1 ) * Math.PI / ( 4 * m - 4 ) ),
                      2 );
        }
        xipts[ m ] = 1;
      }
      function computeFunctionValues( i ) {
        farray = new Array( m + 1 );
        var hi = nodes[ i ] - nodes[ i - 1 ];
        for ( var j = 0; j <= m; j ++ ) {
          var x = nodes[ i - 1 ] + xipts[ j ] * hi;
          farray[ j ] = f( x );
        }
      }
      function onStart() {
//      document.getElementById("debug_textarea").value +=
//        "entering onStart\n";
        interpolate_canvas = document.getElementById("interpolate_canvas");
        w = interpolate_canvas.width;
        m = Number( document.getElementById('m_textarea').value );
        computeInterpolationPoints();
        xarray = new Array();
        yarray = new Array();
        var ymax = -Number.MAX_VALUE;
        var ymin = Number.MAX_VALUE;
        var k = 0;
        for ( n = 1; n <= 256; n *= 2, k ++ ) {
          computeNodes();
          var maxerr = 0;
          for ( var ii = 1; ii <= n; ii ++ ) {
            computeFunctionValues( ii );
            var hi = nodes[ ii ] - nodes[ ii - 1 ];
            var dw = w * hi * .5;
            for ( var jj = 0; jj <= dw; jj ++ ) {
              var xi = jj / dw;
              var spline = lagrangePolynomial( m, xipts, farray, xi );
              maxerr = Math.max( maxerr,
                Math.abs( spline - f( nodes[ ii - 1 ] + hi * xi ) ) );
            }
          }
          if ( maxerr < Number.MIN_VALUE ) break;
          xarray[ k ] = Math.log( n ) * Math.LOG10E;
          yarray[ k ] = Math.log( maxerr ) * Math.LOG10E;
          ymax = Math.max( ymax, yarray[ k ] );
          ymin = Math.min( ymin, yarray[ k ] );
        }

        gt = new XYGraphTool( interpolate_canvas, "interpolation error",
          "log_10(n)", "log_10(error)",
          xarray[ 0 ], xarray[ xarray.length-1 ], ymin, ymax );
        gt.setBgColor( "white" );
        gt.newPage();
        gt.setFgColor( "black" );
        gt.drawAxes();
        gt.setFgColor( "red" );
        gt.beginDrawing();
          gt.movePen( xarray[ 0 ], yarray[ 0 ] );
          for ( var k = 0; k < xarray.length; k ++ ) {
            gt.drawLine( xarray[ k ], yarray[ k ] );
          }
        gt.endDrawing();
//      document.getElementById("debug_textarea").value +=
//        "leaving onStart\n";
      }
    </script>
    <canvas id="interpolate_canvas" width="500" height="300">
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <br>
    Enter piecewise polynomial degree:
    <input
      type="text"
      name="m"
      value="1"
      size="1"
      id="m_textarea"
    >
    <br>
    <br>
    <fieldset>
      <legend> Kind of element interpolation points: </legend>
      <label for="equally_spaced_interpolation_points_checkbox">
        <input
          type="radio"
          checked value="true"
          id="equally_spaced_interpolation_points_checkbox"
          name="equally_spaced_interpolation_points_radiobox"
        />
        uniformly spaced
      </label>
      <label for="optimally_spaced_interpolation_points_checkbox">
        <input
          type="radio"
          value="false"
          id="optimally_spaced_interpolation_points_checkbox"
          name="equally_spaced_interpolation_points_radiobox"
        />
        optimally spaced
      </label>
    </fieldset>
    <br>
    <input
      type="button"
      value="Plot spline approximation error"
      onclick="onStart();"
    >
<!--
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=1
    >
    </textarea>
-->
    <script language="javascript"> onStart(); </script>
  </BODY>
</HTML>
