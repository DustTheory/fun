<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE> Error in Finite Differences </TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
    <script language="javascript"> 
      function f(x) { return Math.sin(x); }
      function fprime(x) { return Math.cos(x); }
      var TICK_LENGTH=0.01;
      function plotError() {
//      document.getElementById("debug_textarea").value +=
//        "in plotError\n";
        var x=1;
        var h=1;
        var nlevels=64;
        var exact=fprime(x);
        var x_array=new Array(nlevels);
        var y_array=new Array(nlevels);
        var ymin,ymax;
        for (var i=0;i<nlevels;i++) {
          var diff=(f(x+h)-f(x))/h;
          x_array[i]=-Math.LOG10E * Math.log(h);
          y_array[i]=Math.LOG10E * Math.log(Math.abs(diff-exact));
          if (i==0) {
            ymin=y_array[i];
            ymax=y_array[i];
          } else {
            ymin=Math.min(ymin,y_array[i]);
            ymax=Math.max(ymax,y_array[i]);
          }
//        document.getElementById("debug_textarea").value +=
//          "i,x_array,y_array = " + i + " " + x_array[i] + " "
//          + y_array[i] + "\n";
          h*=0.5;
        }
        ymax=Math.max(ymax,0);
        ymin=Math.min(ymin,0);
//      document.getElementById("debug_textarea").value +=
//        "ymax,ymin = " + ymax + " " + ymin + "\n";
        var user_coords={
          xhi : 16, // x_array[nlevels-1],
          xlen : 16, // x_array[nlevels-1]-x_array[0],
          xlo : 0, // x_array[0],
          yhi : 0, // ymax,
          ylen : 10, // ymax-ymin,
          ylo : -10 // ymin
        };

        var cnvs = document.getElementById("finite_difference_canvas");
        if (null==cnvs || !cnvs.getContext) return;
        var context=cnvs.getContext("2d");

        context.clearRect(0, 0, cnvs.width, cnvs.height);

        context.strokeStyle="black";
        drawAxes(context,user_coords,"-log_10(h)","log_10(error)");

        context.strokeStyle="blue";
        context.beginPath();
          movePen(context,user_coords,x_array[0],y_array[0]);
        for (var i=1;i<nlevels;i++) {
          drawLine(context,user_coords,x_array[i],y_array[i]);
        }
        context.stroke();
      }

      function drawAxes(ctx,coords,x_label,y_label) {
        var xtic=ticSpacing(coords.xlo,coords.xhi);
        var xfirst_tic=Math.ceil(coords.xlo/xtic);
        var xlast_tic=Math.floor(coords.xhi/xtic);
        var xaxis=Math.max(xtic*xfirst_tic,Math.min(0,xtic*xlast_tic));
        var ytic=ticSpacing(coords.ylo,coords.yhi);
        var yfirst_tic=Math.ceil(coords.ylo/ytic);
        var ylast_tic=Math.floor(coords.yhi/ytic);
        var yaxis=Math.max(ytic*yfirst_tic,Math.min(0,ytic*ylast_tic));
        var tic_pixels=
          TICK_LENGTH*Math.max(ctx.canvas.width,ctx.canvas.height);
        var tic_xlen=coords.xlen*tic_pixels/ctx.canvas.width;
        var tic_ylen=coords.ylen*tic_pixels/ctx.canvas.height;
        ctx.beginPath();
          movePen(ctx,coords,coords.xlo,yaxis);
          drawLine(ctx,coords,coords.xhi,yaxis);
        ctx.stroke();
        for (var i=xfirst_tic;i<=xlast_tic;i++) {
          var x=i*xtic;
          ctx.beginPath();
            movePen(ctx,coords,x,yaxis-tic_ylen);
            drawLine(ctx,coords,x,yaxis+tic_ylen);
          ctx.stroke();
          if (i<0) {
            ctx.textAlign="right";
            ctx.textBaseline="top";
            putString(ctx,coords,x,yaxis,String(x),false);
          } else if (i>0) {
            ctx.textAlign="left";
            ctx.textBaseline="top";
            putString(ctx,coords,x,yaxis,String(x),false);
          }
        }
        ctx.textAlign="right";
        ctx.textBaseline="bottom";
        putString(ctx,coords,xlast_tic*xtic,yaxis,x_label,false);
        ctx.beginPath();
          movePen(ctx,coords,xaxis,coords.ylo);
          drawLine(ctx,coords,xaxis,coords.yhi);
        ctx.stroke();
        for (var i=yfirst_tic;i<=ylast_tic;i++) {
          var y=i*ytic;
          ctx.beginPath();
            movePen(ctx,coords,xaxis-tic_xlen,y);
            drawLine(ctx,coords,xaxis+tic_xlen,y);
          ctx.stroke();
          if (i<0) {
            ctx.textAlign="right";
            ctx.textBaseline="bottom";
            putString(ctx,coords,xaxis,y,String(y),true);
          } else if (i>0) {
            ctx.textAlign="right";
            ctx.textBaseline="top";
            putString(ctx,coords,xaxis,y,String(y),true);
          }
        }
        if (ylast_tic>0) ctx.textAlign="right";
        else ctx.textAlign="right";
        ctx.textBaseline="bottom";
        putString(ctx,coords,xaxis,ylast_tic*ytic,y_label,true);
      }

      function ticSpacing(lo,hi) {
        var sig_digit=Math.pow(10,Math.floor(Math.LOG10E*Math.log(hi-lo)));
        var digit_count=Math.ceil(hi/sig_digit)-Math.ceil(lo/sig_digit);
        if (digit_count>10) return 2*sig_digit;
        else if (digit_count>=5) return sig_digit;
        else if (digit_count>=2) return 0.5*sig_digit;
        else return 0.25*sig_digit;
      }
      
      function putString(ctx,user_coords,x,y,s,vertical) {
        var dx=user_coords.xlen*0.05;
        var xlodx=user_coords.xlo-dx;
        var xhidx=user_coords.xhi+dx;
        var xlendx=xhidx-xlodx;
        var dy=user_coords.ylen*0.05;
        var ylody=user_coords.ylo-dy;
        var yhidy=user_coords.yhi+dy;
        var ylendy=yhidy-ylody;
        var screenx=(x-xlodx)/xlendx*ctx.canvas.width;
        var screeny=(yhidy-y)/ylendy*ctx.canvas.height;
        if (vertical) {
          ctx.save();
          ctx.rotate(-Math.PI/2);
          ctx.strokeText(s,-(yhidy-y)/ylendy*ctx.canvas.height,
                            (x-xlodx)/xlendx*ctx.canvas.width); 
          ctx.restore();
        } else {
          ctx.strokeText(s,(x-xlodx)/xlendx*ctx.canvas.width,
                           (yhidy-y)/ylendy*ctx.canvas.height); 
        }
      }

      function movePen(ctx,user_coords,x,y) {
        var dx=user_coords.xlen*0.05;
        var xlodx=user_coords.xlo-dx;
        var xhidx=user_coords.xhi+dx;
        var xlendx=xhidx-xlodx;
        var dy=user_coords.ylen*0.05;
        var ylody=user_coords.ylo-dy;
        var yhidy=user_coords.yhi+dy;
        var ylendy=yhidy-ylody;
        ctx.moveTo((x-xlodx)/xlendx*ctx.canvas.width,
                   (yhidy-y)/ylendy*ctx.canvas.height);
      }

      function drawLine(ctx,user_coords,x,y) {
        var dx=user_coords.xlen*0.05;
        var xlodx=user_coords.xlo-dx;
        var xhidx=user_coords.xhi+dx;
        var xlendx=xhidx-xlodx;
        var dy=user_coords.ylen*0.05;
        var ylody=user_coords.ylo-dy;
        var yhidy=user_coords.yhi+dy;
        var ylendy=yhidy-ylody;
        ctx.lineTo((x-xlodx)/xlendx*ctx.canvas.width,
                   (yhidy-y)/ylendy*ctx.canvas.height);
      }

/*
      function screenCoords(ctx,user_coords,x,y) {
        var dx=user_coords.xlen*0.05;
        var xlodx=user_coords.xlo-dx;
        var xhidx=user_coords.xhi+dx;
        var xlendx=xhidx-xlodx;
        var dy=user_coords.ylen*0.05;
        var ylody=user_coords.ylo-dy;
        var yhidy=user_coords.yhi+dy;
        var ylendy=yhidy-ylody;
        var screen_coords={
          x : (x-xlodx)/xlendx*ctx.canvas.width,
          y : (yhidy-y)/ylendy*ctx.canvas.height
        }
        return screen_coords;
      }
*/
    </script>
  </HEAD>
  <BODY>
    <h2>
      Finite differences to compute
      \( \sin^\prime(x) \approx \frac{ \sin(x+h) - \sin(x) }{ h } \)
    </h2>

    <canvas
      id="finite_difference_canvas"
      width="500"
      height="500"
    >
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
<!--
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=50
    >
    </textarea>
-->
    <script language="javascript"> plotError(); </script>
  </BODY>
</HTML>
<html><head></head><body></body></html>
