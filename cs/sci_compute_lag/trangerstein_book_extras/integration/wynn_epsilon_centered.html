<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE> Wynn Epsilon Algorithm For Centered Differences </TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
    <script src=../plotting/XYGraphTool.js></script>
    <script language="javascript"> 
      function f(x) { return Math.sin(x); }
      function fprime(x) { return Math.cos(x); }

      var x = 1;
      var h = undefined;
      var alpha = undefined;
//    var alpha2 = undefined;
      var nlevels = undefined;

      var exact = fprime( x );

      var colors = [ "blue", "cyan", "green", "red", "magenta",
        "brown", "black" ];
      var x_array = undefined; // h * alpha^j
      var y_array = undefined; // most recent richardson_extrapolants
      var table = undefined;
      var error = undefined;

      function onStart() {
//      document.getElementById("debug_textarea").value +=
//        "entering onStart\n";
        x_array = new Array( 1 );
        y_array = new Array( 2 );
        table = new Array( 1 );
        table[ 0 ] = new Array( 1 );
        h = 1;
        alpha = .5;
//      alpha2 = alpha * alpha;
        nlevels = 0;
        x_array[ 0 ] = h;
        y_array[ 0 ] = 0;
        var diff = ( f( x + h ) - f( x - h ) ) / ( 2 * h );
//      document.getElementById("debug_textarea").value +=
//        "diff = " + diff + "\n";
        y_array[ 1 ] = diff;
//      document.getElementById("debug_textarea").value +=
//        "y_array[ 0 ] = " + y_array[ 0 ] + "\n";
//      document.getElementById("debug_textarea").value +=
//        "y_array[ 1 ] = " + y_array[ 1 ] + "\n";
        error = Math.LOG10E *
          Math.log( Math.max( 1.e-17, Math.abs( y_array[ 1 ] - exact ) ) );
        table[ nlevels ][ 0 ] = error;
//      document.getElementById("debug_textarea").value +=
//        "table[" + nlevels + "][ 0 ] = " + table[ nlevels ][ 0 ] + "\n";
        plotError();
//      document.getElementById("debug_textarea").value +=
//        "leaving onStart\n";
      }
      function plotError() {
//      document.getElementById("debug_textarea").value +=
//        "entering plotError\n";
        nlevels ++;
//      document.getElementById("debug_textarea").value +=
//        "nlevels = " + nlevels + "\n";
        table[ nlevels ] = new Array( nlevels + 1 );

        var cnvs = document.getElementById("finite_difference_canvas");
        var gt = new XYGraphTool( cnvs, "error in centered differences",
          "h","error", - Math.LOG10E * Math.log( h ), 
          - Math.LOG10E * ( Math.log( h )
          + nlevels * Math.log( alpha ) ), -16, 0 );

        x_array[ nlevels ] = x_array[ nlevels - 1 ] * alpha;
//      document.getElementById("debug_textarea").value +=
//        "x_array[ " + nlevels + " ] = " + x_array[ nlevels ] + "\n";
        var diff = ( f( x + x_array[ nlevels ] )
          - f(x - x_array[ nlevels ] ) ) / ( 2 * x_array[ nlevels ] );
//      document.getElementById("debug_textarea").value +=
//        "diff = " + diff + "\n";
        var yim2 = y_array[ 0 ];
        var yim1 = diff;
        var yi = undefined;
        for ( var i = 2; i <= nlevels + 1; i ++ ) {
          yi = y_array[ i - 2 ] + 1 / ( yim1 - y_array[ i - 1 ] );
          y_array[ i - 2 ] = yim2;
          var im2 = i - 2;
//        document.getElementById("debug_textarea").value +=
//          "y_array[" + im2 + " ] = " + y_array[ im2 ] + "\n";
          yim2 = yim1;
          yim1 = yi;
        }
        y_array[ nlevels ] = yim2;
//      document.getElementById("debug_textarea").value +=
//        "y_array[" + nlevels + "] = " + y_array[ nlevels ] + "\n";
        y_array[ nlevels + 1 ] = yim1;
        var i = nlevels + 1;
//      document.getElementById("debug_textarea").value +=
//        "y_array[" + i + "] = " + y_array[ i ] + "\n";
        for ( var i = 0; i <= nlevels; i += 2 ) {
          table[ nlevels ][ i ] = Math.LOG10E * Math.log(
            Math.max( 1.e-17, Math.abs( y_array[ i + 1 ] - exact ) ) );
//        document.getElementById("debug_textarea").value +=
//          "table[" + nlevels + "][" + i + "] = " + table[ nlevels ][ i ]
//          + "\n";
        }

        gt.setBgColor( "white" );
        gt.newPage();
        gt.setFgColor( "black" );
        gt.drawAxes();
        
        for ( var j = 0; j <= nlevels; j += 2 ) {
          gt.setFgColor( colors[ (j/2) % 5 ] );
          gt.beginDrawing();
            logh = - Math.LOG10E * Math.log( x_array[ j ] );
            gt.drawPlus( logh, table[ 0 ][ j ], 0.04 );
            gt.movePen( logh, table[ 0 ][ j ] );
            for ( var i = 1; i <= nlevels - j; i++ ) {
              logh = - Math.LOG10E * Math.log( x_array[ i ] );
              gt.drawLine( logh, table[ i ][ j ] );
            }
          gt.endDrawing();
        }
//      document.getElementById("debug_textarea").value +=
//        "leaving plotError\n";
      }
    </script>
  </HEAD>
  <BODY>
    <h2>
      Wynn's Epsilon Algorithm using centered differences to compute
      $$\sin^\prime(x) \approx \frac{ \sin(x+h) - \sin(x-h) }{ 2h }$$
    </h2>

    <canvas
      id="finite_difference_canvas"
      width="500"
      height="300"
    >
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <br>
    <input
      type="button"
      value="Start Over"
      onclick="onStart();"
    >
    <br>
    <input
      type="button"
      value="Extend Wynn Epsilon Algorithm"
      onclick="plotError();"
    >
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=1
    >
    </textarea>
    <script language="javascript"> onStart(); </script>
  </BODY>
</HTML>
<html><head></head><body></body></html>
