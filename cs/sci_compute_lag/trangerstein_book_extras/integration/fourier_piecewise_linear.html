<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE>Fourier series approximation to piecewise continuous</TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
  </HEAD>
  <BODY>
    Fourier series approximation to
    $$f(t) = | x - \pi |$$
    <br>
    derivative in red, derivative of Fourier series in blue
    <br>
    <script src=../plotting/XYGraphTool.js></script>
    <script src=../linear_algebra/Complex.js></script>
    <script language="javascript">
      var mm = undefined;
      var nn = undefined;

      function f( t ) { return Math.abs( t - Math.PI ); }
      function fprime( t ) { 
        if ( t > Math.PI ) return 1;
        if ( t < Math.PI ) return -1;
        return 0;
      }
//    function f( t ) { return Math.cos( t ); }
//    function fprime( t ) { return -Math.sin( t ); }
      function fft( m, c ) {
//      adapted from Cooley, Lewis and Welch,
//      IEEE transactions E-12 no 1 (March 1965)
        var j = 1;
        var ndiv2 = Math.pow( 2, m - 1 );
        var n = 2 * ndiv2;
        for ( var i = 1; i < n; i ++ ) {
          if ( i < j ) {
            var temp =
              new Complex( c[ j - 1 ].getReal(), c[ j - 1 ].getImag() );
            c[ j - 1 ].setValue( c[ i - 1 ] );
            c[ i - 1 ].setValue( temp );
          }
          var k = ndiv2;
          while (k < j ) {
            j -= k;
            k /= 2;
          }
          j += k;
        }
        for ( var l = 1; l <= m; l ++ ) {
          var twolm1 = Math.pow( 2, l - 1 );
          var twol = 2 * twolm1;
          var u = new Complex( 1, 0 );
          var theta = Math.PI / twolm1;
          var z = new Complex( Math.cos( theta ), Math.sin( theta ) );
          for ( var j = 1; j <= twolm1; j ++ ) {
            for ( var i = j; i <= n; i += twol ) {
              var p = i + twolm1;
              var temp = ComplexMath.times( c[ p - 1 ], u );
              c[ p - 1 ] = ComplexMath.minus( c[ i - 1 ] , temp );
              c[ i - 1 ].plusEquals( temp );
            }
            u.timesEquals( z );
          }
        }
      }
      function inverseFft( m, c ) {
        fft( m, c );
        var ndiv2 = Math.pow( 2, m - 1 );
        var n = 2 * ndiv2;
        for ( var i = 1; i < ndiv2; i ++ ) {
          var temp = new Complex( c[ i ].getReal(), c[ i ].getImag() );
          c[ i ] .setValue( c[ n - i ] );
          c[ n - i ] .setValue( temp );
        }
        var ninv = 1 / n ;
        for ( var i = 0; i < n; i ++ ) c[ i ].timesNumberEquals( ninv );
      }
      function onStart() {
//      document.getElementById("debug_textarea").value +=
//        "entering onStart\n";
        mm = 2;
        nn = 4;
        fourier_canvas = document.getElementById("fourier_canvas");
        gt = new XYGraphTool( fourier_canvas, "functions",
          "x", "f", 0, 2 * Math.PI, -1.5, 1.5 );
        plotCase();
//      document.getElementById("debug_textarea").value +=
//        "leaving onStart\n";
      }
      function plotCase() {
        document.getElementById("debug_textarea").value =
          "n = " + nn + "\n";
        if ( nn > 512 ) return;
        var c = new Array( nn );
        var dt = 2 * Math.PI / nn;
        for ( var i = 0; i < nn; i ++ ) {
          c[ i ] = new Complex( f( i * dt ), 0 ); 
        }
        inverseFft( mm, c );

        var bigc = new Array( 512 );
        for ( var i = 0; i < 512; i ++ ) {
          bigc[ i ] = new Complex( 0, 0 );
        }
//      bigc[ 0 ] = new Complex( c[ 0 ].getReal(), c[ 0 ].getImag() );
        for ( var i = 1; i < nn / 2; i ++ ) {
//        multiply c[i] by i * sqrt(-1):
          bigc[ i ] =
            new Complex( - i * c[ i ].getImag(), i * c[ i ].getReal() );
//        multiply c[n-i] by -i * sqrt(-1):
          bigc[ 512 - i ] = new Complex( i * c[ nn - i ].getImag(),
            - i * c[ nn - i ].getReal() );
        }
        fft( 9, bigc );

        gt.setBgColor( "white" );
        gt.newPage();
        gt.setFgColor( "black" );
        gt.drawAxes();
        gt.setFgColor( "red" );
        dt = 2 * Math.PI / 512;
        gt.beginDrawing();
          gt.movePen( 0, fprime( 0 ) );
          for ( var i = 1; i < 512; i ++ ) {
            var t = i * dt;
            gt.drawLine( t, fprime( t ) );
          }
        gt.endDrawing();
        gt.setFgColor( "blue" );
        gt.beginDrawing();
          gt.movePen( 0, bigc[ 0 ].getReal() );
          for ( var i = 1; i < bigc.length; i ++ ) {
            gt.drawLine( i * dt, bigc[ i ].getReal() );
          }
        gt.endDrawing();
//      gt.setFgColor( "green" );
//      gt.beginDrawing();
//        gt.movePen( 0, bigc[ 0 ].getImag() );
//        for ( var i = 1; i < bigc.length; i ++ ) {
//          gt.drawLine( i * dt, bigc[ i ].getImag() );
//        }
//      gt.endDrawing();
        nn *= 2;
        mm ++;
      }
    </script>
    <canvas id="fourier_canvas" width="512" height="512">
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <br>
    <input
      type="button"
      value="Double the order"
      onclick="plotCase();"
    >
    <br>
    <input
      type="button"
      value="Start over"
      onclick="onStart();"
    >
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=1
    >
    </textarea>
    <script language="javascript"> onStart(); </script>
  </BODY>
</HTML>
