<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE> Richardson Extrapolation Using Centered Differences </TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
    <script src=../plotting/XYGraphTool.js></script>
    <script language="javascript"> 
      function f(x) { return Math.sin(x); }
      function fprime(x) { return Math.cos(x); }

      var x = 1;
      var h = undefined;
      var alpha = undefined;
      var alpha2 = undefined;
      var nlevels = undefined;

      var exact = fprime( x );

      var colors = [ "blue", "cyan", "green", "yellow", "red", "magenta",
        "brown", "black" ];
      var x_array = new Array( 1 ); // h * alpha^j
      var y_array = new Array( 1 ); // most recent richardson_extrapolants
      var table = new Array( 1 );
      table[ 0 ] = new Array( 1 );
      var error = undefined;

      function onStart() {
        h = 1;
        alpha = .5;
        alpha2 = alpha * alpha;
        nlevels = 1;
        x_array[ 0 ] = h;
        y_array[ 0 ] = ( f( x + h ) - f( x - h ) ) / ( 2 * h );
        error = Math.LOG10E *
          Math.log( Math.max( 1.e-17, Math.abs( y_array[ 0 ] - exact ) ) );
        table[ 0 ][ 0 ] = error;
        plotError();
      }
      function plotError() {
//      document.getElementById("debug_textarea").value +=
//        "entering plotError\n";
//      if ( nlevels >= colors.length ) return;
        table[ nlevels ] = new Array( nlevels + 1 );

        var cnvs = document.getElementById("finite_difference_canvas");
        var gt = new XYGraphTool( cnvs, "error in centered differences",
          "h","error", - Math.LOG10E * Math.log( h ), 
          - Math.LOG10E * ( Math.log( h )
          + nlevels * Math.log( alpha ) ), -16, 0 );

        x_array[ nlevels ] = x_array[ nlevels - 1 ] * alpha;
        var diff = ( f( x + x_array[ nlevels ] )
          - f(x - x_array[ nlevels ] ) ) / ( 2 * x_array[ nlevels ] );
        var alpha_power = alpha2;
        for ( var i = 0; i < nlevels; i ++ ) {
          var next_diff = diff + ( diff - y_array[ i ] )
            * alpha_power / ( 1 - alpha_power );
          y_array[ i ] = diff;
          var error = Math.LOG10E * Math.log(
            Math.max( 1.e-17, Math.abs( y_array[ i ] - exact ) ) );
          table[ nlevels ][ i ] = error;
          diff = next_diff;
          alpha_power *= alpha2;
        }
        y_array[ nlevels ] = diff;
        error = Math.LOG10E * Math.log(
          Math.max( 1.e-17, Math.abs( y_array[ nlevels ] - exact ) ) );
        table[ nlevels ][ nlevels ] = error;

        gt.setBgColor( "white" );
        gt.newPage();
        gt.setFgColor( "black" );
        gt.drawAxes();
        
        for ( var j = 0; j <= nlevels; j ++ ) {
          gt.setFgColor( colors[ j % 6] );
          gt.beginDrawing();
            logh = - Math.LOG10E * Math.log( x_array[ j ] );
            gt.drawPlus( logh, table[ j ][ j ], 0.04 );
            gt.movePen( logh, table[ j ][ j ] );
            for ( var i = j + 1; i <= nlevels; i++ ) {
              logh = - Math.LOG10E * Math.log( x_array[ i ] );
              gt.drawLine( logh, table[ i ][ j ] );
            }
          gt.endDrawing();
        }
        nlevels ++;
//      document.getElementById("debug_textarea").value +=
//        "leaving plotError\n";
      }
    </script>
  </HEAD>
  <BODY>
    <h2>
      Richardson extrapolation using centered differences to compute
      $$\sin^\prime(x) \approx \frac{ \sin(x+h) - \sin(x-h) }{ 2h }$$
    </h2>

    <canvas
      id="finite_difference_canvas"
      width="500"
      height="300"
    >
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <br>
    <input
      type="button"
      value="Start Over"
      onclick="onStart();"
    >
    <br>
    <input
      type="button"
      value="Extend Richardson Extrapolation"
      onclick="plotError();"
    >
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=1
    >
    </textarea>
    <script language="javascript"> onStart(); </script>
  </BODY>
</HTML>
<html><head></head><body></body></html>
