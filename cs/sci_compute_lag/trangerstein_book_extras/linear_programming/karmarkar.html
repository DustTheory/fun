<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE> Karmarkar Algorithm </TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
  </HEAD>
  <BODY>
    <h2>
      Karmarkar iteration to solve
      <br>
      \(
        min [ -3, -2, -1 ] {\bf x} \;\text{subject to}\;
        [ 1, 1, 1 ]{\bf x} = 1 \;\text{and}\; {\bf x} \geq {\bf 0}
      \)
    </h2>
    <h>
      contours of objective in feasible region:
      <br>
    </h>
    <script src=../plotting/AreaGraphTool.js></script>
    <script src=../plotting/Colormap.js></script>
    <script src=../plotting/Palette.js></script>
<!--
    <script src=../linear_algebra/Complex.js></script>
-->
    <script language="javascript">
      var gt = undefined;
//    var nc = [ 10, 10 ];
//    var low = [ -0.5, Math.sqrt(1./3.) - Math.sqrt(0.75) ];
//    var high = [  0.5, Math.sqrt(1./3.) ];
      var low = [ -0.55, -0.35 ];
      var high = [  0.55, 0.65 ];
      function threeDtoTwoD( x1, x2 ) {
        return new Array( ( x2 - x1 ) / 2,
          Math.sqrt(1./3.) - ( x1 + x2 ) * Math.sqrt( 0.75 ) );
      }
      var x = undefined;
      var c = undefined;
      var A = undefined;
//    var cnew = undefined;

      function onStart() {
//      document.getElementById("debug_textarea").value +=
//        "entering onStart\n";
        var p = new Palette();
        var cm = new Colormap( p );
        gt = new AreaGraphTool(
          document.getElementById("function_canvas"),"vector field test",
          "x", "y ", low, high, cm );
        gt.setBgColor();
        gt.newPage();
        gt.setFgColor( );
//      gt.drawAxes();
        gt.beginDrawing();
//        boundary of feasible region
          var pos = threeDtoTwoD( 1., 0. );
//        document.getElementById("debug_textarea").value +=
//          "pos = " + pos[0] + " " + pos[1] + "\n";
          gt.movePen( pos );
          pos = threeDtoTwoD( 0., 1. );
//        document.getElementById("debug_textarea").value +=
//          "pos = " + pos[0] + " " + pos[1] + "\n";
          gt.setFgColor( );
          gt.drawLine( pos );
          pos = threeDtoTwoD( 0., 0. );
          gt.drawLine( pos );
          pos = threeDtoTwoD( 1., 0. );
          gt.drawLine( pos );
        gt.endDrawing();
//      contours of objective
        gt.beginDrawing();
          gt.setFgColor( 1./6. );
          pos = threeDtoTwoD( 5./6., 0. );
          gt.movePen( pos );
          pos = threeDtoTwoD( 2./3., 1./3. );
          gt.drawLine( pos );
        gt.endDrawing();
        gt.beginDrawing();
          gt.setFgColor( 2./6. );
          pos = threeDtoTwoD( 2./3., 0. );
          gt.movePen( pos );
          pos = threeDtoTwoD( 1./3., 2./3. );
          gt.drawLine( pos );
        gt.endDrawing();
        gt.beginDrawing();
          gt.setFgColor( 3./6. );
          pos = threeDtoTwoD( 0.5, 0. );
          gt.movePen( pos );
          pos = threeDtoTwoD( 0., 1. );
          gt.drawLine( pos );
        gt.endDrawing();
        gt.beginDrawing();
          gt.setFgColor( 4./6. );
          pos = threeDtoTwoD( 1./3., 0. );
          gt.movePen( pos );
          pos = threeDtoTwoD( 0., 2./3. );
          gt.drawLine( pos );
        gt.endDrawing();
        gt.beginDrawing();
          gt.setFgColor( 5./6. );
          pos = threeDtoTwoD( 1./6., 0. );
          gt.movePen( pos );
          pos = threeDtoTwoD( 0., 1./3. );
          gt.drawLine( pos );
        gt.endDrawing();

        x=new Array(3);
        x[0] = Math.random();
        x[1] = ( 1 - x[0] ) * Math.random();
        x[2] = 1 - x[0] - x[1];
        c = [ -3, -2, -1 ];
        A = [ 1, 1, 1 ];

        gt.beginDrawing();
          gt.setFgColor( );
          var pos = threeDtoTwoD( x[0], x[1] );
          gt.movePen( pos );
//        document.getElementById("debug_textarea").value +=
//          "x = " + x[0] + " " + x[1] + " " + x[2] + "\n";
//        document.getElementById("debug_textarea").value +=
//          "A = " + A[0] + " " + A[1] + " " + A[2] + "\n";
          var L = Math.sqrt( Math.pow(A[0],2) + Math.pow(A[1],2)
            + Math.pow(A[2],2) );
          var Q = new Array(3);
          for (var i = 0; i < 3; i ++ ) Q[ i ] = A[ i ] / L;
//        document.getElementById("debug_textarea").value +=
//          "L = " + L + "\n";
//        document.getElementById("debug_textarea").value +=
//          "Q = " + Q[0] + " " + Q[1] + " " + Q[2] + "\n";
          var dot = Q[0] * c[0] + Q[1] * c[1] + Q[2] * c[2];
          var z = new Array(3);
          for ( var i = 0; i < 3; i ++ ) z[i] = c[i] - Q[i] * dot;
//        document.getElementById("debug_textarea").value +=
//          "c = " + c[0] + " " + c[1] + " " + c[2] + "\n";
//        document.getElementById("debug_textarea").value +=
//          "dot = " + dot + "\n";
//        document.getElementById("debug_textarea").value +=
//          "z = " + z[0] + " " + z[1] + " " + z[2] + "\n";
          var lambda = Number.MAX_VALUE;
          for ( var i = 0; i < 3; i ++ ) {
            if ( z[i] > 0 ) lambda = Math.min( lambda, x[ i ] / z[ i ] );
          }
          lambda *= 0.1;
//        document.getElementById("debug_textarea").value +=
//          "lambda = " + lambda + "\n";
          for ( var i = 0; i < 3; i ++ ) {
            x[ i ] = x[ i ] - z[ i ] * lambda;
          }
//        document.getElementById("debug_textarea").value +=
//          "x = " + x[0] + " " + x[1] + " " + x[2] + "\n";
          pos = threeDtoTwoD( x[0], x[1] );
          gt.drawLine( pos );
        gt.endDrawing();

//      document.getElementById("debug_textarea").value +=
//        "leaving onStart\n";
      }
      function iterate( ) {
//      document.getElementById("debug_textarea").value +=
//        "entering iterate\n";
        gt.beginDrawing();
          var pos = threeDtoTwoD( x[0], x[1] );
          gt.setFgColor( );
          gt.movePen( pos );
          var diag = new Array(3);
          for (var i = 0; i < 3; i ++ ) diag[i] = x[i] * 3.;
//        document.getElementById("debug_textarea").value +=
//          "x = " + x[0] + " " + x[1] + " " + x[2] + "\n";
//        document.getElementById("debug_textarea").value +=
//          "c = " + c[0] + " " + c[1] + " " + c[2] + "\n";
//        document.getElementById("debug_textarea").value +=
//          "diag = " + diag[0] + " " + diag[1] + " " + diag[2] + "\n";
          var Anew = new Array(3);
          for (var i = 0; i < 3; i ++ ) Anew[i] = A[i] * diag[i];
          var L = Math.sqrt( Math.pow(Anew[0],2)
            + Math.pow(Anew[1],2) + Math.pow(Anew[2],2) );
          var Q = new Array(3);
          for (var i = 0; i < 3; i ++ ) Q[ i ] = Anew[ i ] / L;
//        document.getElementById("debug_textarea").value +=
//          "Anew = " + Anew[0] + " " + Anew[1] + " " + Anew[2] + "\n";
//        document.getElementById("debug_textarea").value +=
//          "L = " + L + "\n";
//        document.getElementById("debug_textarea").value +=
//          "Q = " + Q[0] + " " + Q[1] + " " + Q[2] + "\n";
          var cnew = new Array(3);
          for (var i = 0; i < 3; i ++ ) cnew[i] = diag[i] * c[i];
          var dot = Q[0] * cnew[0] + Q[1] * cnew[1] + Q[2] * cnew[2];
          var z = new Array(3);
          for ( var i = 0; i < 3; i ++ ) z[i] = cnew[i] - Q[i] * dot;
//        document.getElementById("debug_textarea").value +=
//          "cnew = " + cnew[0] + " " + cnew[1] + " " + cnew[2] + "\n";
//        document.getElementById("debug_textarea").value +=
//          "dot = " + dot + "\n";
//        document.getElementById("debug_textarea").value +=
//          "z = " + z[0] + " " + z[1] + " " + z[2] + "\n";
          var lambda = Number.MAX_VALUE;
          for ( var i = 0; i < 3; i ++ ) {
            if ( z[i] > 0 ) {
              lambda = Math.min( lambda, 1. / (3. * z[ i ] ) );
            }
          }
          lambda *= 0.96;
//        document.getElementById("debug_textarea").value +=
//          "lambda = " + lambda + "\n";
          for ( var i = 0; i < 3; i ++ ) {
            x[ i ] = diag[ i ] * ( 1./3. - z[ i ] * lambda );
          }
//        document.getElementById("debug_textarea").value +=
//          "x = " + x[0] + " " + x[1] + " " + x[2] + "\n";
          pos = threeDtoTwoD( x[0], x[1] );
          gt.drawLine( pos );
        gt.endDrawing();
//      document.getElementById("debug_textarea").value +=
//        "leaving iterate\n";
      }
    </script>
    <canvas id="function_canvas" width="500" height="500">
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <br>
    <input
      type="button"
      value="Choose a different initial guess"
      onclick="onStart();"
    >
    <br>
    <input
      type="button"
      value="Continue iteration"
      onclick="iterate();"
    >
<!--
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=50
    >
    </textarea>
-->
    <script language="javascript"> onStart(); </script>
  </BODY>
</HTML>
