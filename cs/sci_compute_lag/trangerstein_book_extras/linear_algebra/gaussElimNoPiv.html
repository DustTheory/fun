<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE> Gaussian Factorization without Pivoting </TITLE>
  </HEAD>
  <BODY>
    <h2> Gaussian Factorization without Pivoting </h2>
    <script src=JSMatrix.js></script>
    <script language="javascript">
    var matrix_text="1,2,3;4,5,6";

    function factorMatrix( ) {
      document.getElementById("left_factor_textarea").value="";
      document.getElementById("right_factor_textarea").value="";
      document.getElementById("factor_error_textarea").value="";
      var m = new JSMatrix();
      m.parse( matrix_text );
      var mf = new JSMatrix();
      mf.copy( m );

      var rank = 0;
      for ( var k = 0; k < Math.min( mf.numberRows(), mf.numberCols()); k++)
      {
        var pivot = mf.getEntry( k, k );
        if ( Math.abs( pivot ) <= 0 ) break;
        rank ++;
        var kp1 = k + 1;
        for ( var i = kp1; i < mf.numberRows(); i ++ ) {
          mf.setEntry( i, k, mf.getEntry( i, k ) / pivot );
        }
        for ( var j = kp1; j < mf.numberCols(); j ++ ) {
          var r = mf.getEntry( k, j );
          for ( var i = kp1; i < mf.numberRows(); i ++ ) {
            mf.setEntry( i, j,
              mf.getEntry( i, j ) - mf.getEntry( i, k ) * r );
          }
        }
      }

      var sa = new Array( mf.numberRows() * mf.numberCols() );
      var cw = new Array( mf.numberCols() );
      for ( var j = 0; j < rank; j ++ ) {
        sa[ j + j * mf.numberRows() ] = new String();
        sa[ j + j * mf.numberRows() ] = '1';
        cw[ j ] = sa[ j + j * mf.numberRows() ].length;
        for ( var i = j + 1; i < mf.numberRows(); i ++ ) {
          sa[ i + j * mf.numberRows() ] = 
            scientificFormat( mf.getEntry( i, j ) );
          cw[ j ]=Math.max( sa[ i + j * mf.numberRows() ].length, cw[ j ] );
        }
      }
//    display left factor
      document.getElementById("left_factor_textarea").style.color = "green";
      document.getElementById("left_factor_textarea").value += "L = \n";
      for ( var i = 0; i < mf.numberRows(); i ++ ) {
        var str = new String();
        for ( var j = 0; j < Math.min( i, rank ); j ++ ) {
          var sj = sa[ i + j * mf.numberRows() ];
          while ( sj.length < cw[ j ] ) sj += ' ';
          str += sj + ' ';
        }
        if ( i < rank ) str += '1';
        document.getElementById("left_factor_textarea").value += str + "\n";
      }
      for ( var j = 0; j < mf.numberCols(); j ++ ) {
        cw[ j ] = 0;
        for ( var i = 0; i <= Math.min( j, rank - 1 ); i ++ ) {
          sa[ i + j * mf.numberRows() ] = 
            scientificFormat( mf.getEntry( i, j ) );
          cw[ j ]=Math.max( sa[ i + j * mf.numberRows() ].length, cw[ j ] );
        }
      }
//    display right factor
      document.getElementById("right_factor_textarea").style.color = "red";
      document.getElementById("right_factor_textarea").value += "R = \n";
      for ( var i = 0; i < rank; i ++ ) {
        var str2 = new String();
        for ( var j = 0; j < i; j ++ ) {
          var sj2 = '';
          while ( sj2.length < cw[ j ] ) sj2 = ' ' + sj2;
          str2 += sj2 + ' ';
        }
        for ( var j = i; j < mf.numberCols() - 1; j ++ ) {
          sj2 = sa[ i + j * mf.numberRows() ];
          while ( sj2.length < cw[ j ] ) sj2 = ' ' + sj2;
          str2 += sj2 + ' ';
        }
        j = mf.numberCols() - 1;
        sj2 = sa[ i + j * mf.numberRows() ];
        while ( sj2.length < cw[ j ] ) sj2= ' ' + sj2;
        str2 += sj2;
        document.getElementById("right_factor_textarea").value += str2
          + "\n";
      }
//    compute A - L * R
      var p = new JSMatrix();
      p.copy( m );
      for ( var j = 0; j < rank; j ++ ) {
        for ( var i = 0; i <= j; i ++ ) {
          var sum = 0.;
          for ( var l = 0; l < i; l ++ ) {
            sum += mf.getEntry( i, l ) * mf.getEntry( l, j );
          }
          sum += mf.getEntry( i, j );
          p.setEntry( i, j, p.getEntry( i, j ) - sum );
        }
        for ( var i = j + 1; i < mf.numberRows(); i ++ ) {
          sum = 0.;
          for ( var l = 0; l <= j; l ++ ) {
            sum += mf.getEntry( i, l ) * mf.getEntry( l, j );
          }
          p.setEntry( i, j, p.getEntry( i, j ) - sum );
        }
      }
      for ( var j = rank; j < mf.numberCols(); j ++ ) {
        for ( var i = 0; i < rank; i ++ ) {
          sum = 0.;
          for ( var l = 0; l < i; l ++ ) {
            sum += mf.getEntry( i, l ) * mf.getEntry( l, j );
          }
          sum += mf.getEntry( i, j );
          p.setEntry( i, j, p.getEntry( i, j ) - sum );
        }
        for ( var i = rank; i < mf.numberRows(); i ++ ) {
          sum = 0.;
          for ( var l = 0; l < rank; l ++ ) {
            sum += mf.getEntry( i, l ) * mf.getEntry( l, j );
          }
          p.setEntry( i, j, p.getEntry( i, j ) - sum );
        }
      }
//    compute entry lengths
      for ( var j=0; j < mf.numberCols(); j ++ ) {
        cw[ j ] = 0;
        for ( var i = 0; i < m.numberRows(); i ++ ) {
          cw[ j ] = Math.max( cw[ j ],
            scientificFormat( p.getEntry( i, j ) ).length);
        }
      }
//    display A - L * R
      document.getElementById("factor_error_textarea").style.color = "blue";
      document.getElementById("factor_error_textarea").value +=
        "A - L * R = \n";
      for ( var i = 0; i < p.numberRows(); i ++ ) {
        var str3 = new String();
        for ( var j = 0; j < p.numberCols() - 1; j ++ ) {
          var sj3 = scientificFormat( p.getEntry( i, j ) );
          while ( sj3.length < cw[ j ] ) sj3 += ' ';
          str3 += sj3 + " ";
        }
        str3 += scientificFormat( p.getEntry( i, p.numberCols() - 1 ) );
        document.getElementById("factor_error_textarea").value += str3
          + "\n";
      }
    }

    function scientificFormat( n ) {
      var an = Math.abs(n);
      if ( an>=0.01 && an<=100. ) return n.toString();
      else return n.toExponential();
    }
    </script>
    Enter matrix:
    <input
      type="text"
      name="matrix_text"
      value="1,2,3;4,5,6"
      size="50"
    >
    <input
      type="button"
      value="Factor without pivoting"
      onclick="matrix_text=document.getElementsByName('matrix_text')[0].value;factorMatrix();"
    >
    <br>
    <textarea
      id="left_factor_textarea"
      cols=100
      rows=10
    >
    </textarea>
    <textarea
      id="right_factor_textarea"
      cols=100
      rows=10
    >
    </textarea>
    <textarea
      id="factor_error_textarea"
      cols=100
      rows=10
    >
    </textarea>
<!--
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=50
    >
    </textarea>
-->
    <script language="javascript"> factorMatrix(); </script>
  </BODY>
</HTML>
