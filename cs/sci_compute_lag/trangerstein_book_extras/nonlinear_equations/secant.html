<HTML>
  <HEAD>
    <meta charset="UTF-8">
    <TITLE> Secant method </TITLE>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
  </HEAD>
  <BODY>
    <h2>
      Secant method to find a zero of \( f(x) = 4 \sin(x) + 1- x \)
    </h2>
    <script src=../plotting/XYGraphTool.js></script>
    <script language="javascript">
      var log10 = Math.log( 10. );
      var npts = 100;
      var A = -4;
      var B = 4;
      var newsoln = undefined;
      var oldsoln = undefined;
      var newf = undefined;
      var oldf = undefined;
      var gt = undefined;
      var xarray = new Array( npts + 1 );
      var farray = new Array( npts + 1 );
      var earray = new Array();

      function f( x ) { return 4 * Math.sin( x ) + 1 - x; }

      function computePlotPoints( ) {
        var dx = ( B - A ) * 0.0625;
        var a = A - dx;
        var b = B + dx;
        var dx = ( b - a ) / npts;
        var fmax = f( a ); 
        var fmin = fmax; 
        xarray[ 0 ] = a;
        farray[ 0 ] = fmax;
        for ( var i = 1; i <= npts; i ++ ) {
          xarray[ i ] = xarray[ i - 1 ] + dx;
          farray[ i ] = f( xarray[ i ] );
          fmin = Math.min( fmin, farray[ i ] );
          fmax = Math.max( fmax, farray[ i ] );
        }
        return {
          flo : fmin,
          fhi : fmax
        }
      }

      function plotPoints( ) {
        gt.beginDrawing();
          gt.movePen( xarray[ 0 ], farray[ 0 ] );
          for ( var i = 1; i < xarray.length; i ++ ) {
            gt.drawLine( xarray[ i ], farray[ i ] );
          }
        gt.endDrawing();
      }

      function plotSecantLine( x1, f1, x2, f2 ) {
        if ( Math.abs( f2 - f1 ) > 0 ) {
          var fpx = ( f2 - f1 ) / ( x2 - x1 );
          var secantY_at_xlo = f1 - fpx * ( x1 - gt.user_xlo );
          var secantY_at_xhi = f1 + fpx * ( gt.user_xhi - x1 );
          secantX_at_ylo = x1 - ( f1 - gt.user_ylo ) / fpx;
          secantX_at_yhi = x1 + ( gt.user_yhi - f1 ) / fpx;
          if ( gt.user_ylo <= secantY_at_xlo &&
          secantY_at_xlo <= gt.user_yhi ) {
            if ( gt.user_xlo <= secantX_at_ylo &&
            secantX_at_ylo <= gt.user_xhi ) {
              gt.beginDrawing();
                gt.movePen( gt.user_xlo, secantY_at_xlo );
                gt.drawLine( secantX_at_ylo, gt.user_ylo );
              gt.endDrawing();
            } else {
              if ( gt.user_ylo <= secantY_at_xhi &&
              secantY_at_xhi <= gt.user_yhi ) {
                gt.beginDrawing();
                  gt.movePen( gt.user_xlo, secantY_at_xlo );
                  gt.drawLine( gt.user_xhi, secantY_at_xhi );
                gt.endDrawing();
              } else if ( gt.user_xlo <= secantX_at_yhi &&
              secantX_at_yhi <= gt.user_xhi ) {
                gt.beginDrawing();
                  gt.movePen( gt.user_xlo, secantY_at_xlo );
                  gt.drawLine( secantX_at_yhi, gt.user_yhi );
                gt.endDrawing();
              }
            }
          } else if ( gt.user_xlo <= secantX_at_ylo &&
          secantX_at_ylo <= gt.user_xhi ) {
            if ( gt.user_ylo <= secantY_at_xhi &&
            secantY_at_xhi <= gt.user_yhi ) {
              gt.beginDrawing();
                gt.movePen( secantX_at_ylo, gt.user_ylo );
                gt.drawLine( gt.user_xhi, secantY_at_xhi );
              gt.endDrawing();
            } else if ( gt.user_xlo <= secantX_at_yhi &&
            secantX_at_yhi <= gt.user_xhi ) {
              gt.beginDrawing();
                gt.movePen( secantX_at_ylo, gt.user_ylo );
                gt.drawLine( secantX_at_yhi, gt.user_yhi );
              gt.endDrawing();
            }
          } else if ( gt.user_ylo <= secantY_at_xhi &&
          secantY_at_xhi <= gt.user_yhi ) {
            if ( gt.user_xlo <= secantX_at_yhi &&
            secantX_at_yhi <= gt.user_xhi ) {
              gt.beginDrawing();
                gt.movePen( gt.user_xhi, secantY_at_xhi );
                gt.drawLine( secantX_at_yhi, gt.user_yhi );
              gt.endDrawing();
            }
          }
        } else {
          if ( gt.user_ylo <= f1 && f1 <= gt.user_yhi ) {
            gt.beginDrawing();
              gt.movePen( gt.user_xlo, f1 );
              gt.drawLine( gt.user_xhi, f1 );
            gt.endDrawing();
          }
        }
      }

      function plotError( ) {
//      document.getElementById("debug_textarea").value +=
//        "entering plotError\n";
        var ymin = Number.MAX_VALUE;
        var ymax = -Number.MAX_VALUE;
        for ( var i = 0; i < earray.length; i ++ ) {
          ymin = Math.min( ymin, earray[ i ] ); 
          ymax = Math.max( ymax, earray[ i ] ); 
        }
        gte = new XYGraphTool( document.getElementById("error_canvas"),
          "function value vs iteration", "iteration number", "abs(f(x)) ",
          0, earray.length - 1, ymin, ymax );
        gte.setBgColor( "white" );
        gte.newPage();
        gte.setFgColor( "black" );
        gte.drawBoundingBox();
        gte.drawAxes();
        gte.setFgColor( "red" );
        gte.beginDrawing();
          gte.movePen( 0, earray[ 0 ] );
          for ( var i = 1; i < earray.length; i ++ ) {
            gte.drawLine( i, earray[ i ] );
          }
        gte.endDrawing();
//      document.getElementById("debug_textarea").value +=
//        "leaving plotError\n";
      }

      function onStart() {
//      document.getElementById("debug_textarea").value +=
//        "entering onStart\n";
        A = -4;
        B = 4;
        earray = new Array();
        var fbounds = computePlotPoints( );
        gt = new XYGraphTool( document.getElementById("secant_canvas"),
          "secant method", "x", "f ", A, B, fbounds.flo, fbounds.fhi );
        gt.setBgColor( "white" );
        gt.newPage();
        gt.setFgColor( "black" );
        gt.drawBoundingBox();
        gt.drawAxes();
        gt.setFgColor( "blue" );
        plotPoints( );
        gt.mouseUp = firstSecantIteration;
        gt.watchMouse();
        gt.listen();
//      document.getElementById("debug_textarea").value +=
//        "leaving onStart\n";
      }

      function firstSecantIteration( ) {
//      document.getElementById("debug_textarea").value +=
//        "entering firstSecantIteration, mouseX,Y = "
//        + gt.mouseX + " " + gt.mouseY + "\n";
//      document.getElementById("debug_textarea").value +=
//        "earray.length = " + earray.length + "\n";
        if ( earray.length == 0 ) {
          oldsoln = gt.mouseX;
          oldf = f( oldsoln );
          earray.push( Math.log( Math.abs( f(oldsoln) ) ) / log10 );
          gt.watchMouse();
        } else if ( earray.length == 1 ) {
          newsoln = gt.mouseX;
          newf = f( newsoln );
          earray.push( Math.log( Math.abs( f(newsoln) ) ) / log10 );
          secantIteration();
        }
//      document.getElementById("debug_textarea").value +=
//        "leaving firstSecantIteration\n";
      }

      function secantIteration() {
//      document.getElementById("debug_textarea").value +=
//        "entering secantIteration\n";
        if ( earray.length == 1 ) {
          gt.watchMouse();
          return;
        }
        gt.setBgColor( "white" );
        gt.newPage();
        gt.setFgColor( "black" );
        gt.drawBoundingBox();
        gt.drawAxes();
        gt.setFgColor( "blue" );
        plotPoints( );
        gt.setFgColor( "red" );
        plotSecantLine( oldsoln, oldf, newsoln, newf );
        gt.setFgColor( "green" );
        gt.drawCross( oldsoln, oldf );
        gt.drawCross( newsoln, newf );
        if ( Math.abs( newsoln - oldsoln ) <= 0 ) {
          document.getElementById("debug_textarea").value +=
            "secant points not distinct\n";
          return;
        }
        var slope = ( newf - oldf ) / ( newsoln - oldsoln );
        if ( Math.abs( slope ) <= 0 ) {
          document.getElementById("debug_textarea").value +=
            "secant slope is zero\n";
          return;
        }
        oldf = newf;
        oldsoln = newsoln;
        newsoln -= newf / slope;
        newf = f( newsoln );
        A = Math.min( A, newsoln );
        B = Math.max( B, newsoln );
        document.getElementById("debug_textarea").value =
          "current guess = " + newsoln
          + " f(current guess) = " + newf +"\n";

        var fbounds = computePlotPoints( );
        gt.rescale( A, B, fbounds.flo, fbounds.fhi );

        earray.push( Math.log( Math.abs( newf ) ) / log10 );
        plotError();
//      document.getElementById("debug_textarea").value +=
//        "leaving secantIteration\n";
      }
    </script>
    1) Click mouse once in drawing area to select first secant guess
    <br>
    2) Click "Perform another Secant iteration"
    <br>
    3) Click mouse again in drawing area to select second secant guess
    <br>
    4) Click "Perform another Secant iteration" for additional secant steps
    <br>
    <canvas id="secant_canvas" width="500" height="300">
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <canvas id="error_canvas" width="500" height="300">
      Apparently, your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element
    </canvas>
    <br>
    <input
      type="button"
      value="Perform another Secant iteration"
      onclick="secantIteration();"
    >
    <input
      type="button"
      value="Restart secant iteration from the beginning"
      onclick="onStart();"
    >
    <br>
    <textarea
      id="debug_textarea"
      cols=100
      rows=2
    >
    </textarea>
    <script language="javascript"> XYGraphTool.onload("secant_canvas");onStart(); </script>
  </BODY>
</HTML>
